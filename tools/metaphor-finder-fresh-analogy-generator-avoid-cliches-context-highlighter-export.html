<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GE98V48RK8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GE98V48RK8');
  </script>

  <!-- Microsoft Clarity -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "t5y2d08vd0");
  </script>
  <meta name="msvalidate.01" content="A9EB890789B5C28E62629F99EEDC30A1" />

  <!-- Essentials -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <base href="/tools/">

  <!-- Primary SEO -->
  <title>Metaphor Finder - Fresh Metaphors & Similes, Avoid Cliches, Highlight & Export | SnipText</title>
  <meta name="description" content="Find fresh metaphors and similes with category, tone, and intensity filters. Highlight in context, avoid cliches and mixed metaphors, build a replacement map, and export as CSV or JSON. Private, fast, in-browser." />
  <meta name="keywords" content="metaphor finder, metaphor generator, simile finder, analogy generator, avoid cliches, mixed metaphors, writing style, classroom friendly, export CSV JSON, SnipText" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <!-- Canonical & hreflang -->
  <link rel="canonical" href="https://checkai.pro/tools/metaphor-finder-fresh-analogy-generator-avoid-cliches-context-highlighter-export" />
  <link rel="alternate" href="https://checkai.pro/tools/metaphor-finder-fresh-analogy-generator-avoid-cliches-context-highlighter-export" hreflang="en" />
  <link rel="alternate" href="https://checkai.pro/tools/metaphor-finder-fresh-analogy-generator-avoid-cliches-context-highlighter-export" hreflang="x-default" />

  <!-- Styles -->
  <link rel="stylesheet" href="/css/style.css?v=reset1" />
  <link rel="stylesheet" href="/tools/css/free-tools.css?v=reset1" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="SnipText" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:title" content="Metaphor Finder - Fresh Metaphors & Similes, Avoid Cliches, Highlight & Export" />
  <meta property="og:description" content="Generate and insert metaphors with smart filters, highlight them in context, and export a replacement map. Private and fast in your browser." />
  <meta property="og:url" content="https://checkai.pro/tools/metaphor-finder-fresh-analogy-generator-avoid-cliches-context-highlighter-export" />
  <meta property="og:image" content="https://checkai.pro/images/sniptext-default-tools-img.png" />
  <meta property="og:image:secure_url" content="https://checkai.pro/images/sniptext-default-tools-img.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="SnipText tool preview" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Metaphor Finder - Fresh Metaphors & Similes, Avoid Cliches, Highlight & Export" />
  <meta name="twitter:description" content="Find fresh metaphors, avoid cliches, and export your replacement map. Private, in-browser." />
  <meta name="twitter:image" content="https://checkai.pro/images/sniptext-default-tools-img.png" />

  <!-- Theme / Icons -->
  <meta name="theme-color" content="#1D4ED8" />
  <link rel="icon" href="/favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />

  <!-- JSON-LD: WebApplication -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"SnipText Metaphor Finder",
    "url":"https://checkai.pro/tools/metaphor-finder-fresh-analogy-generator-avoid-cliches-context-highlighter-export",
    "applicationCategory":"UtilitiesApplication",
    "operatingSystem":"All",
    "isAccessibleForFree":true,
    "browserRequirements":"Requires JavaScript; modern browser",
    "featureList":[
      "Metaphor and simile generator",
      "Category, tone, and intensity filters",
      "Cliche and mixed metaphor flags",
      "Context highlighting and inline replace",
      "Favorites and history",
      "Import custom lists (JSON)",
      "Export replacement map (CSV/JSON)",
      "Shareable URL state",
      "Keyboard shortcuts"
    ],
    "publisher":{"@type":"Organization","name":"Snip Text","logo":{"@type":"ImageObject","url":"https://checkai.pro/favicon.png","width":512,"height":512}}
  }
  </script>

  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"Is the Metaphor Finder private?","acceptedAnswer":{"@type":"Answer","text":"Yes. Everything runs locally in your browser. Your text and lists are not uploaded."}},
      {"@type":"Question","name":"Can I import my own metaphor list?","acceptedAnswer":{"@type":"Answer","text":"Yes. Import a JSON array of objects with fields: text, form, category, tone, intensity, domain, tags, and cliche."}},
      {"@type":"Question","name":"Can I export a map of replacements?","acceptedAnswer":{"@type":"Answer","text":"Yes. Export your applied replacements or current library view as CSV or JSON."}},
      {"@type":"Question","name":"Does it detect mixed metaphors or cliches?","acceptedAnswer":{"@type":"Answer","text":"It flags common cliches from the list and warns when multiple domains collide in a short span (a mixed metaphor signal)."}}
    ]
  }
  </script>

  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://checkai.pro/"},
      {"@type":"ListItem","position":2,"name":"Tools","item":"https://checkai.pro/tools/free-tools.html"},
      {"@type":"ListItem","position":3,"name":"Metaphor Finder","item":"https://checkai.pro/tools/metaphor-finder-fresh-analogy-generator-avoid-cliches-context-highlighter-export"}
    ]
  }
  </script>

  <style>
/* =========================
   Brand tokens (mapped)
   ========================= */
:root{
  --color-primary:#1D4ED8;
  --color-accent:#3B82F6;
  --color-bg-dark:#0F172A;
  --color-white:#ffffff;
  --color-text-light:#E5E7EB;
  --color-border:rgba(255,255,255,.14);
  --color-used-often:#e85d27;
  --gradient-cta-end:#ff7c4c;

  --font-heading:'Poppins','Segoe UI',system-ui,-apple-system,Roboto,'Helvetica Neue',Arial,sans-serif;
  --font-body:'Roboto','Poppins','Segoe UI',system-ui,-apple-system,'Helvetica Neue',Arial,sans-serif;

  /* Page aurora like the model page */
  --mf-aurora-1: color-mix(in oklab, var(--color-primary) 26%, transparent);
  --mf-aurora-2: color-mix(in oklab, var(--color-accent) 22%, transparent);
  --mf-aurora-3: color-mix(in oklab, var(--gradient-cta-end) 12%, transparent);

  --radius-xl:20px;
  --radius-lg:16px;
  --radius-md:12px;

  --shadow-1:0 10px 30px rgba(0,0,0,.35);
  --shadow-2:0 18px 48px rgba(17,24,39,.46);
}

/* =========================
   Base + fixed aurora background
   ========================= */
*{box-sizing:border-box}
html,body{height:100%}
html,body{
  margin:0;
  background:var(--color-bg-dark);
  color:var(--color-white);
  font-family:var(--font-body);
  line-height:1.55;
}
body::before{
  content:"";
  position:fixed; inset:0; z-index:-2;
  background:
    radial-gradient(1200px 600px at 10% -10%, var(--mf-aurora-1), transparent 60%),
    radial-gradient(900px 500px at 100% 0%,  var(--mf-aurora-2), transparent 52%),
    radial-gradient(800px 520px at 0% 100%, var(--mf-aurora-3), transparent 58%),
    linear-gradient(180deg, var(--color-bg-dark) 0%, #0b1225 100%);
}

/* =========================
   App container + spacing
   ========================= */
.metaphor-page{ padding: clamp(16px,2.8vw,28px); }
.metaphor-container{ max-width:1200px; margin:0 auto; isolation:isolate; }

/* =========================
   Hero matches role-model
   ========================= */
.metaphor-hero{
  position:relative;
  padding: clamp(18px,3vw,28px);
  border:1px solid var(--color-border);
  background: linear-gradient(135deg,
      color-mix(in oklab, var(--color-primary) 20%, transparent),
      color-mix(in oklab, var(--color-accent) 18%, transparent)
    ) border-box;
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-1);
  overflow:hidden;
  display:grid; gap: clamp(8px,2vw,12px);
  margin-bottom: clamp(14px,2.6vw,24px);
}
.metaphor-hero::after{
  content:""; position:absolute; inset:-3px; pointer-events:none; filter: blur(16px); opacity:.6;
  background:
    radial-gradient(600px 220px at 18% -6%, color-mix(in oklab, var(--color-primary) 28%, transparent), transparent 65%),
    radial-gradient(460px 280px at 86% 0%,  color-mix(in oklab, var(--color-accent) 26%, transparent), transparent 62%);
}
.metaphor-title{
  margin:0;
  font: 800 clamp(22px,3.2vw,36px)/1.12 var(--font-heading);
  letter-spacing:.2px;
  background: linear-gradient(90deg,#fff,
    color-mix(in oklab, var(--color-primary) 54%, #fff) 38%,
    color-mix(in oklab, var(--gradient-cta-end) 40%, #fff) 78%, #fff);
  -webkit-background-clip:text; background-clip:text; color:transparent;
}
.metaphor-sub{
  margin:0;
  color: color-mix(in oklab, var(--color-text-light) 78%, transparent);
  font-size: clamp(14px,1.8vw,16px);
}

/* =========================
   Grid
   ========================= */
.metaphor-grid{
  display:grid;
  grid-template-columns: 1fr;
  gap: clamp(12px,2.4vw,20px);
}
@media (min-width: 1000px){
  .metaphor-grid{ grid-template-columns: 1.1fr .9fr; }
}

/* =========================
   Cards = glass surfaces
   ========================= */
.metaphor-card{
  border:1px solid var(--color-border);
  border-radius: var(--radius-lg);
  background: rgba(255,255,255,0.06);
  box-shadow: var(--shadow-2);
  backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  overflow:hidden;
}
.metaphor-card-h{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:12px 14px; border-bottom:1px solid var(--color-border);
  background: linear-gradient(90deg,
    color-mix(in oklab, var(--color-accent) 11%, transparent),
    color-mix(in oklab, var(--color-primary) 9%, transparent));
}
.metaphor-card-t{
  font:700 14px/1 var(--font-heading);
  letter-spacing:.35px; text-transform:uppercase; opacity:.92;
  display:flex; align-items:center; gap:10px;
}
.metaphor-chip{
  border:1px solid var(--color-border); padding:6px 10px; border-radius:999px;
  font-size:12px; color:#AAB6C7; background: color-mix(in oklab, var(--color-bg-dark) 72%, transparent);
  backdrop-filter: blur(6px);
}
.metaphor-card-b{ padding:12px 14px; display:grid; gap:12px; }

/* =========================
   Inputs + selects + textarea
   ========================= */
.metaphor-textarea{
  width:100%; min-height:220px; resize:vertical;
  background:#0f1b34; color:#e5e7eb; border:1px solid var(--color-border);
  border-radius: var(--radius-md); padding:12px; outline:0; font-size:15px;
}
.metaphor-input, .metaphor-select, .metaphor-number{
  background:#0f1b34; color:#e5e7eb; border:1px solid var(--color-border);
  border-radius:10px; padding:9px 12px; outline:0; min-height:36px;
  transition: border-color .2s ease, box-shadow .2s ease, background .2s ease;
}
.metaphor-select{ background:#0e1730; }
.metaphor-input::placeholder{ color:#94a3b8; }
.metaphor-input:focus, .metaphor-select:focus, .metaphor-number:focus, .metaphor-textarea:focus{
  border-color: rgba(59,130,246,.35);
  box-shadow: 0 0 0 3px rgba(59,130,246,.15);
}

/* =========================
   Buttons = filled, ghost, warm
   ========================= */
.metaphor-btn{
  --_bg: linear-gradient(180deg,
    color-mix(in oklab, var(--color-primary) 70%, transparent),
    color-mix(in oklab, var(--color-accent) 62%, transparent));
  --_txt:#fff; --_bd: color-mix(in oklab, #000 12%, var(--color-primary));
  appearance:none; border:1px solid var(--_bd); background:var(--_bg); color:var(--_txt);
  padding:10px 12px; border-radius:12px; font-weight:700; font-size:13px; letter-spacing:.3px; cursor:pointer; position:relative;
  transition: transform .15s ease, filter .15s ease, box-shadow .2s ease, background .3s ease;
  box-shadow: 0 10px 20px rgba(29,78,216,.22), 0 6px 14px rgba(59,130,246,.16);
  font-family: var(--font-heading);
}
.metaphor-btn-prim{ border-color:transparent;background:linear-gradient(135deg,var(--metaphor-primary),var(--metaphor-accent))}
.metaphor-btn-warm{
  --_bg: linear-gradient(180deg,
    color-mix(in oklab, var(--color-used-often) 48%, transparent),
    color-mix(in oklab, var(--gradient-cta-end) 32%, transparent));
  --_bd: color-mix(in oklab, #000 18%, var(--color-used-often));
}
.metaphor-btn-ghost{
  background: transparent; color: #e5e7eb;
  border:1px dashed var(--color-border); box-shadow:none; font-weight:600;
}
.metaphor-btn:hover{ transform: translateY(-1px); filter: brightness(1.06); }
.metaphor-btn:active{ transform: translateY(0); filter: brightness(.98); }

/* =========================
   Layout helpers inside cards
   ========================= */
.metaphor-flex{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
.metaphor-actions{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; }

/* =========================
   Result area, list, code
   ========================= */
.metaphor-result{
  min-height:180px; border:1px dashed var(--color-border);
  border-radius:12px; padding:12px; background: rgba(255,255,255,.04);
  overflow:auto;
}
.metaphor-status{ display:flex; flex-wrap:wrap; gap:8px; }
.metaphor-status .ok{ color:#22c55e; }
.metaphor-status .warn{ color:#ffb454; }
.metaphor-status .bad{ color:#ff6b6b; }

.metaphor-list{ max-height:290px; overflow:auto; display:grid; gap:10px; }
.metaphor-item{
  border:1px solid var(--color-border); border-radius:12px; padding:10px;
  background: rgba(255,255,255,.06); display:grid; gap:6px;
  transition: transform .12s ease, background .2s ease, border-color .2s ease; backdrop-filter: blur(6px);
}
.metaphor-item:hover{ transform: translateY(-1px); background: rgba(255,255,255,.08); }
.metaphor-item h4{ margin:0; font-size:14px; }
.metaphor-item small{ color:#AAB6C7; }
.metaphor-mini{ display:flex; gap:6px; align-items:center; flex-wrap:wrap; }
.metaphor-tag{
  font-size:12px; color:#AAB6C7; border:1px dashed var(--color-border);
  padding:3px 8px; border-radius:999px;
}

.metaphor-code{
  width:100%; min-height:140px;
  background: rgba(255,255,255,.06); color:#e6efff;
  border:1px solid var(--color-border); border-radius:12px; padding:12px;
  font:12px/1.6 ui-monospace,SFMono-Regular,Menlo,Consolas,"Roboto Mono",monospace; white-space:pre; overflow:auto;
}

/* =========================
   Chips, kbd, marks
   ========================= */
.metaphor-kbd{
  font:600 12px/1 var(--font-body);
  border:1px solid var(--color-border); padding:3px 6px; border-radius:6px;
  background:#0c1429; color:#e6edff;
}
.metaphor-result .tag{
  display:inline-block; margin:0 6px 6px 0; padding:4px 8px;
  border:1px solid var(--color-border); border-radius:999px; font-size:12px; color:#AAB6C7;
}
.metaphor-mark{ background:linear-gradient(90deg, rgba(29,78,216,.25), rgba(59,130,246,.25)); border-bottom:1px dashed #3B82F6; }
.metaphor-mark.cliche{ background:linear-gradient(90deg, rgba(232,93,39,.28), rgba(232,93,39,.18)); border-bottom:1px dashed #e85d27; }
.metaphor-mark.mixed{ background:linear-gradient(90deg, rgba(255,180,84,.25), rgba(255,180,84,.15)); border-bottom:1px dashed #ffb454; }

/* =========================
   Toasts
   ========================= */
.metaphor-toasts{ position: fixed; right:16px; bottom:16px; display:grid; gap:8px; z-index:50; }
.metaphor-toast{
  background:#0b1223ee; color:#e5e7eb;
  border:1px solid var(--color-border); padding:10px 12px; border-radius:12px;
  box-shadow: var(--shadow-1); opacity:0; transform: translateY(20px);
  transition: transform .25s ease, opacity .25s ease;
}
.metaphor-toast.show{ opacity:1; transform: translateY(0); }

/* =========================
   Float animation like model
   ========================= */
@media (prefers-reduced-motion: no-preference){
  .metaphor-card { animation: mf-float 18s ease-in-out infinite; }
  @keyframes mf-float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-2px)} }
}

/* =========================
   Responsive refinements
   ========================= */
@media (max-width: 680px){
  .metaphor-flex{ gap:8px; }
  .metaphor-actions{ gap:8px; }
  .metaphor-card-h{ padding:10px 12px; }
  .metaphor-card-b{ padding:10px 12px; }
}

.feature-card-all-pages {margin: 0 2rem;}
.tools-grid {margin: 1rem; background: #0e1730;}
.tool-card {background: #0f1b34;}
@media (max-width: 600px) { .tools-grid {margin: 1rem 0;} }

  </style>
</head>
<body>


  
<nav id="main-navbar">
  <div class="nav-container">
    <div class="logo">
      <a href="/index.html">Snip Text</a>
    </div>
    <div class="hamburger" id="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <ul class="nav-links" id="nav-links">
      <li><a href="/index.html">Home</a></li>
      <li><a href="/tools/free-tools.html">Free Tools</a></li>
      <li><a href="/features.html">Features</a></li>
      <li><a href="/about.html">About</a></li>
      <li><a href="/blog/blog.html">Blog</a></li>
      <li><a href="/contact.html">Contact</a></li>
      <li><a id="nav-dashboard-link" href="/login.html">Dashboard</a></li>
      <li><a id="nav-logout-link" href="#" style="display:none;">Logout</a></li>
    </ul>
  </div>
</nav>




 
  <main class="metaphor-page" id="metaphor-app">
    <div class="metaphor-container">
      <!-- Hero -->
      <section class="metaphor-hero">
        <h1 class="metaphor-title">Metaphor Finder</h1>
        <p class="metaphor-sub">Spice up writing with fresh metaphors and similes. Filter by category, tone, and intensity, avoid cliches, flag mixed metaphors, and export a replacement map. Private, instant, in your browser.</p>
      </section>

      <section class="metaphor-grid">
        <!-- Left: Editor -->
        <article class="metaphor-card">
          <header class="metaphor-card-h">
            <div class="metaphor-card-t">
              <!-- small inline icon -->
              <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M3 8c5-7 13-7 18 0M3 16c5 7 13 7 18 0" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                <path d="M8 12h8" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
              </svg>
              Metaphor editor
              <span class="metaphor-chip">Shortcuts: <span class="metaphor-kbd">Ctrl</span> + <span class="metaphor-kbd">Enter</span> generate • <span class="metaphor-kbd">Ctrl</span> + <span class="metaphor-kbd">B</span> replace</span>
            </div>
            <div class="metaphor-flex">
              <button class="metaphor-btn metaphor-btn-prim" id="metaphor-generate">Generate ideas</button>
              <button class="metaphor-btn" id="metaphor-insert">Insert into text</button>
              <button class="metaphor-btn metaphor-btn-ghost" id="metaphor-copy">Copy selection</button>
            </div>
          </header>
          <div class="metaphor-card-b">
            <textarea id="metaphor-textarea" class="metaphor-textarea" placeholder="Paste or write your paragraph here. Select a bland phrase to replace, or just insert ideas and edit freely."></textarea>

            <div class="metaphor-actions">
              <div class="metaphor-flex">
                <label>Target word/phrase
                  <input id="metaphor-target" class="metaphor-input" placeholder="e.g., 'very cold' or 'busy city'"/>
                </label>
                <label>Form
                  <select id="metaphor-form" class="metaphor-select">
                    <option value="">Any</option>
                    <option value="metaphor">Metaphor</option>
                    <option value="simile">Simile</option>
                    <option value="personification">Personification</option>
                  </select>
                </label>
                <label>Category
                  <select id="metaphor-category" class="metaphor-select">
                    <option value="">Any</option>
                    <option>Nature</option>
                    <option>Technology</option>
                    <option>Emotion</option>
                    <option>Time</option>
                    <option>Movement</option>
                    <option>Light</option>
                    <option>Sound</option>
                    <option>Food</option>
                  </select>
                </label>
                <label>Tone
                  <select id="metaphor-tone" class="metaphor-select">
                    <option value="">Any</option>
                    <option>Formal</option>
                    <option>Poetic</option>
                    <option>Playful</option>
                    <option>Dark</option>
                    <option>Inspirational</option>
                    <option>Academic</option>
                  </select>
                </label>
                <label>Intensity
                  <input id="metaphor-intensity" class="metaphor-number" type="number" min="1" max="5" step="1" value="3" />
                </label>
                <label class="metaphor-flex" style="gap:6px">
                  <input type="checkbox" id="metaphor-no-cliche" checked/> Avoid cliches
                </label>
                <label class="metaphor-flex" style="gap:6px">
                  <input type="checkbox" id="metaphor-live"/> Live insert
                </label>
              </div>
              <div class="metaphor-flex">
                <input id="metaphor-seed" class="metaphor-input" placeholder="Optional seed words (comma separated)"/>
                <button class="metaphor-btn" id="metaphor-share">Share link</button>
                <button class="metaphor-btn" id="metaphor-scan">Scan & highlight</button>
                <span class="metaphor-chip" id="metaphor-stats">0 ideas • 0 favorites</span>
              </div>
            </div>

            <div class="metaphor-result" id="metaphor-result" aria-live="polite">
              <div class="metaphor-status" id="metaphor-status">
                <span class="ok">Ready</span>
              </div>
              <div id="metaphor-picked" style="margin-top:8px"></div>
            </div>
          </div>
        </article>

        <!-- Right: Ideas & Library -->
        <article class="metaphor-card">
          <header class="metaphor-card-h">
            <div class="metaphor-card-t">🎯 Metaphor ideas & library</div>
            <div class="metaphor-flex">
              <input type="file" id="metaphor-file" accept="application/json" hidden>
              <button class="metaphor-btn" id="metaphor-import">Import JSON</button>
              <button class="metaphor-btn metaphor-btn-ghost" id="metaphor-export-json">Export JSON</button>
              <button class="metaphor-btn metaphor-btn-ghost" id="metaphor-export-csv">Export CSV</button>
            </div>
          </header>
          <div class="metaphor-card-b">
            <div class="metaphor-flex">
              <input id="metaphor-search" class="metaphor-input" placeholder="Search library or tags...">
              <button class="metaphor-btn" id="metaphor-clear">Clear filters</button>
              <button class="metaphor-btn metaphor-btn-warm" id="metaphor-fav">Add current to favorites</button>
              <button class="metaphor-btn" id="metaphor-view-fav">View favorites</button>
              <button class="metaphor-btn metaphor-btn-ghost" id="metaphor-clear-fav">Clear favorites</button>
            </div>

            <div class="metaphor-list" id="metaphor-list" aria-label="Metaphor library"></div>
            <small id="metaphor-count" class="metaphor-chip">Showing 0 of 0</small>
          </div>
        </article>
      </section>

      <!-- Replacement Map / JSON block -->
      <section class="metaphor-card" style="margin-top:14px">
        <header class="metaphor-card-h">
          <div class="metaphor-card-t">🗂 Replacement map & JSON list</div>
          <div class="metaphor-flex">
            <button class="metaphor-btn metaphor-btn-ghost" id="metaphor-copy-json">Copy JSON</button>
            <button class="metaphor-btn metaphor-btn-ghost" id="metaphor-download-json">Download JSON</button>
            <button class="metaphor-btn metaphor-btn-ghost" id="metaphor-export-map">Export map CSV</button>
          </div>
        </header>
        <div class="metaphor-card-b">
          <pre class="metaphor-code" id="metaphor-json"></pre>
          <small class="metaphor-chip">Tip: keep classroom sets by exporting and re-importing JSON. No upload required.</small>
        </div>
      </section>
    </div>

    <div class="free-tools-guide">
      <p>Read our blog guide for Metaphor Finder <a class="free-tools-blog-link" href="/blog/metaphor-finder-guide-fresh-metaphors-and-similes-avoid-cliches-with-context-highlighter-sniptext-blog.html">here</a>.</p>
    </div>

    <!-- Toasts -->
    <div class="metaphor-toasts" id="metaphor-toasts"></div>
  </main>


    <!-- TOOLS GRID -->
       <div class="feature-card-all-pages">
        <h1 class="feature-card-all-pages-para">Featured Tools</h1>
       </div>
  <section id="tools-grid" class="tools-grid" aria-label="Tools list">
    <!-- Tool cards - 10 items -->

              <article class="tool-card anagram-tool-card" tabindex="0" data-href="/tools/anagram-generator-fast-anagram-filters-multi-word-export-sniptext-tool.html" aria-labelledby="anagram-tg">
                  <div class="card-icon anagram-card-icon" aria-hidden="true">
                    <!-- Anagram icon: shuffled arrows + letter tiles -->
                    <svg viewBox="0 0 24 24" class="svg-icon anagram-svg" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Anagram Generator">
                      <!-- shuffle arrows -->
                      <path d="M3 7h4c2 0 3 3 5 3h6" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                      <path d="M15.5 5.2 19 7.5l-3.5 2.3" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M3 17h4c2 0 3-3 5-3h6" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                      <path d="M15.5 14.2 19 16.5l-3.5 2.3" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                      <!-- letter tiles -->
                      <rect x="2.8" y="9.4" width="4.6" height="4.6" rx="1" fill="none" stroke="currentColor" stroke-width="1.2"/>
                      <text x="5.1" y="12.6" text-anchor="middle" font-size="2.6" font-family="ui-sans-serif, system-ui" fill="currentColor">A</text>
                      <rect x="16.6" y="8.1" width="4.6" height="4.6" rx="1" fill="none" stroke="currentColor" stroke-width="1.2" opacity=".95"/>
                      <text x="18.9" y="11.3" text-anchor="middle" font-size="2.6" font-family="ui-sans-serif, system-ui" fill="currentColor">G</text>
                    </svg>
                  </div>
                  <h3 id="anagram-tg" class="card-title anagram-card-title">Anagram Generator</h3>
                  <p class="card-desc anagram-card-desc">
                    Rearrange letters into single or multi-word anagrams with smart filters for length, starts/ends with, include or exclude letters, and wildcard patterns. Rank by frequency or Scrabble score, paste your own dictionary, and export results. Private, in-browser.
                  </p>
                  <a class="card-cta anagram-card-cta" href="/tools/anagram-generator-fast-anagram-filters-multi-word-export-sniptext-tool.html" aria-label="Open Anagram Generator">Open →</a>
              </article>

              <article class="tool-card piglatin-card-teaser" tabindex="0"
                  data-href="/tools/pig-latin-converter-fun-accurate-and-classroom-friendly.html"
                  aria-labelledby="t-piglatin">
                  <div class="card-icon" aria-hidden="true">
                    <!-- Pig Latin icon: pig snout + speech bubble "ay" motif -->
                    <svg viewBox="0 0 24 24" class="svg-icon" role="img" aria-label="Pig Latin Converter icon">
                      <!-- head -->
                      <circle cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="1.6"/>
                      <!-- ears -->
                      <path d="M7.2 6.5l-2-1.6 0 2.8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M16.8 6.5l2-1.6 0 2.8" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                      <!-- snout -->
                      <ellipse cx="12" cy="14" rx="4.2" ry="2.6" fill="none" stroke="currentColor" stroke-width="1.6"/>
                      <circle cx="10.7" cy="14" r="0.7" fill="currentColor"/>
                      <circle cx="13.3" cy="14" r="0.7" fill="currentColor"/>
                      <!-- smile hint -->
                      <path d="M9 11.2c.8.5 2 .5 3 0" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
                      <!-- speech bubble tail with tiny 'ay' strokes -->
                      <path d="M18 9.2c1.9 0 3.3 1.4 3.3 3.1 0 1.8-1.4 3.2-3.3 3.2h-1.1l-1.2 1.3v-1.3h-0.2"
                            fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M17.2 11.5l.5 1.6m1-1.6l-.5 1.6" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
                    </svg>
                  </div>
                  <h3 id="t-piglatin" class="card-title">Pig Latin Converter</h3>
                  <p class="card-desc">
                    Turn English into Pig Latin with smart punctuation and capitalization, choose suffix styles, see side by side diffs, try reverse mode, and export TXT, CSV, or JSON. Private, in browser.
                  </p>
                  <a class="card-cta"
                    href="/tools/pig-latin-converter-fun-accurate-and-classroom-friendly.html"
                    aria-label="Open Pig Latin Converter">Open →</a>
              </article>

              <article class="tool-card writingprompt-tool-card" tabindex="0"
                      data-href="/tools/random-writing-prompt-generator-json-list-filters-export.html"
                      aria-labelledby="writingprompt-tg">
                      <div class="card-icon writingprompt-card-icon" aria-hidden="true">
                        <!-- Writing Prompt icon: dice + pencil + spark -->
                        <svg viewBox="0 0 24 24" class="svg-icon writingprompt-svg" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Random Writing Prompt Generator">
                          <!-- dice -->
                          <rect x="2.5" y="2.5" width="9" height="9" rx="2" fill="none" stroke="currentColor" stroke-width="1.4"/>
                          <circle cx="5.3" cy="5.3" r="0.9" fill="currentColor"/>
                          <circle cx="8.7" cy="5.3" r="0.9" fill="currentColor"/>
                          <circle cx="7" cy="8.7" r="0.9" fill="currentColor"/>
                          <!-- pencil -->
                          <path d="M14.2 6.8l6.6 6.6c.5.5.5 1.3 0 1.8l-3.6 3.6c-.5.5-1.3.5-1.8 0l-6.6-6.6 5.4-5.4z" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/>
                          <path d="M7.9 12.1l1.8 1.8" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                          <!-- pencil tip fill -->
                          <path d="M20.8 13.6l-1.8-1.8-1.5 1.5 1.8 1.8 1.5-1.5z" fill="currentColor"/>
                          <!-- spark -->
                          <path d="M12.2 2.6l.5-1 .5 1 1 .5-1 .5-.5 1-.5-1-1-.5 1-.5z" stroke="currentColor" stroke-width="1.1" fill="none"/>
                        </svg>
                      </div>
                      <h3 id="writingprompt-tg" class="card-title writingprompt-card-title">Random Writing Prompt Generator</h3>
                      <p class="card-desc writingprompt-card-desc">
                        Generate story ideas with genre, tone, and length filters. Save favorites, search the library, import your own JSON list, and export visible results as JSON or CSV. Share a link to your exact settings. Private, in-browser.
                      </p>
                      <a class="card-cta writingprompt-card-cta"
                        href="/tools/random-writing-prompt-generator-json-list-filters-export.html"
                        aria-label="Open Random Writing Prompt Generator">Open →</a>
                  </article>

    <article class="tool-card" tabindex="0" data-href="/tools/symbol-character-info.html" aria-labelledby="t6">
      <div class="card-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" class="svg-icon">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </svg>
      </div>
      <h3 id="t6" class="card-title">Symbol / Character Info</h3>
      <p class="card-desc">Counts symbols and shows ASCII & Unicode code points and names for selected characters.</p>
      <a class="card-cta" href="/tools/symbol-character-info.html" aria-label="Open Symbol/Character Counter">Open →</a>
    </article>

  </section>






  
<footer id="main-footer" class="site-footer" aria-labelledby="footer-heading">
  <!-- decorative background -->
  <div class="footer-bg" aria-hidden="true"></div>

  <div class="footer-container">
    <div class="footer-logo">
      <h2 id="footer-heading" class="footer-brand">Snip Text</h2>
      <p>Empowering better writing, one tool at a time.</p>
    </div>

    <nav class="footer-links" aria-label="Footer links">
      <a href="feedback.html">Feedback</a>
      <a href="contact.html#contact">Contact Us</a>
      <a href="privacy-policy.html">Privacy Policy</a>
      <a href="terms-of-use.html">Terms of Use</a>
    </nav>

    <div class="footer-bottom">
      <p>
        &copy; <span id="year"></span>
        <span class="powered-by">
          Snip Text - powered by
          <a href="https://checkai.pro" target="_blank" rel="noopener">CheckAI.pro</a>
        </span>
        · All rights reserved.
      </p>
    </div>
  </div>

  <!-- back to top -->
  <button class="to-top" id="to-top" aria-label="Back to top">
    <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
      <path d="M12 5l-6 6m6-6l6 6M12 5v14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
</footer>





    <!-- Include the JavaScript file for this page -->
<script src="js/index.js?v=reset1" defer></script>
<script src="js/auth.js?v=reset1" defer></script>
<script src="/tools/js/free-tools.js?v=reset1"></script>

  <script>
    // ---------- Utilities ----------
    const $ = (s, p=document)=>p.querySelector(s);
    const $$ = (s, p=document)=>[...p.querySelectorAll(s)];
    const csvRow = cells => cells.map(v => `"${String(v).replace(/"/g,'""')}"`).join(',') + '\\n';
    const downloadFile = (name, text, type='text/plain') => {
      const blob = new Blob([text], {type}); const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = name; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    };
    const toast = (msg) => {
      const wrap = $('#metaphor-toasts'); const t = document.createElement('div'); t.className='metaphor-toast'; t.textContent=msg;
      wrap.appendChild(t); requestAnimationFrame(()=>t.classList.add('show')); setTimeout(()=>{t.classList.remove('show'); setTimeout(()=>t.remove(), 250)}, 1400);
    };
    const escapeHTML = s => String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));

    // ---------- Default Metaphors (seed list) ----------
    // Fields: text (string, include {X} placeholder to inject target), form, category, tone, intensity 1-5, domain, tags[], cliche (bool)
    const metaphorDefault = [
      {id:1, text:"{X} is a glacier inching through noon traffic", form:"metaphor", category:"Movement", tone:"Playful", intensity:3, domain:"Nature", tags:["slow","city"], cliche:false},
      {id:2, text:"{X} is a lighthouse in a fog of deadlines", form:"metaphor", category:"Light", tone:"Inspirational", intensity:3, domain:"Sea", tags:["guidance","work"], cliche:false},
      {id:3, text:"{X} is a browser with 99 tabs and no sound", form:"metaphor", category:"Technology", tone:"Humorous", intensity:2, domain:"Tech", tags:["overwhelm"], cliche:false},
      {id:4, text:"{X} is caffeine for a sleepy thesis", form:"metaphor", category:"Food", tone:"Playful", intensity:2, domain:"Food", tags:["energy","study"], cliche:false},
      {id:5, text:"{X} is a moth chasing a desk lamp", form:"simile", category:"Movement", tone:"Poetic", intensity:2, domain:"Nature", tags:["drawn to","light"], cliche:false},
      {id:6, text:"{X} spreads like ink in water", form:"simile", category:"Movement", tone:"Poetic", intensity:3, domain:"Nature", tags:["diffusion"], cliche:false},
      {id:7, text:"{X} is a firewall against panic", form:"metaphor", category:"Technology", tone:"Formal", intensity:3, domain:"Tech", tags:["protection"], cliche:false},
      {id:8, text:"{X} is a museum of unsent drafts", form:"metaphor", category:"Time", tone:"Dark", intensity:2, domain:"Culture", tags:["nostalgia"], cliche:false},
      {id:9, text:"{X} sings in the gears of morning", form:"personification", category:"Sound", tone:"Poetic", intensity:4, domain:"Mechanics", tags:["hope"], cliche:false},
      {id:10, text:"{X} is a compass when maps give up", form:"metaphor", category:"Movement", tone:"Inspirational", intensity:3, domain:"Navigation", tags:["direction"], cliche:false},
      // mild cliches (will be filtered if avoid cliches)
      {id:11, text:"{X} is a breath of fresh air", form:"metaphor", category:"Nature", tone:"Casual", intensity:2, domain:"Nature", tags:["relief"], cliche:true},
      {id:12, text:"{X} is busy as a bee", form:"simile", category:"Movement", tone:"Casual", intensity:2, domain:"Nature", tags:["work"], cliche:true},
    ];

    // ---------- State ----------
    const state = {
      library: [...metaphorDefault],
      favorites: [],
      replacements: [], // {from, to, position}
      picked: null,
      historyIds: new Set(),
      viewFavorites: false
    };

    // ---------- Elements ----------
    const els = {
      ta: $('#metaphor-textarea'),
      target: $('#metaphor-target'),
      form: $('#metaphor-form'),
      category: $('#metaphor-category'),
      tone: $('#metaphor-tone'),
      intensity: $('#metaphor-intensity'),
      noCliche: $('#metaphor-no-cliche'),
      seed: $('#metaphor-seed'),
      live: $('#metaphor-live'),
      status: $('#metaphor-status'),
      picked: $('#metaphor-picked'),
      list: $('#metaphor-list'),
      count: $('#metaphor-count'),
      json: $('#metaphor-json'),
      stats: $('#metaphor-stats'),
      search: $('#metaphor-search'),
      // buttons
      gen: $('#metaphor-generate'),
      insert: $('#metaphor-insert'),
      copy: $('#metaphor-copy'),
      scan: $('#metaphor-scan'),
      share: $('#metaphor-share'),
      importBtn: $('#metaphor-import'),
      file: $('#metaphor-file'),
      exportJSON: $('#metaphor-export-json'),
      exportCSV: $('#metaphor-export-csv'),
      fav: $('#metaphor-fav'),
      viewFav: $('#metaphor-view-fav'),
      clearFav: $('#metaphor-clear-fav'),
      clearFilters: $('#metaphor-clear'),
      copyJSON: $('#metaphor-copy-json'),
      downloadJSON: $('#metaphor-download-json'),
      exportMap: $('#metaphor-export-map'),
    };

    // ---------- Filtering ----------
    function filteredLibrary(){
      const q = (els.search.value||'').toLowerCase().trim();
      const intensity = Number(els.intensity.value || 0);
      return (state.viewFavorites ? state.favorites : state.library).filter(m=>{
        if (els.form.value && m.form !== els.form.value) return false;
        if (els.category.value && m.category !== els.category.value) return false;
        if (els.tone.value && m.tone !== els.tone.value) return false;
        if (intensity && m.intensity !== intensity) return false;
        if (els.noCliche.checked && m.cliche) return false;
        if (q && !(m.text.toLowerCase().includes(q) || (m.tags||[]).some(t=>String(t).toLowerCase().includes(q)))) return false;
        return true;
      });
    }

    function renderList(){
      const items = filteredLibrary();
      els.list.innerHTML = '';
      for(const m of items.slice(0,120)){
        const d = document.createElement('div');
        d.className = 'metaphor-item';
        const label = (els.target.value||'{X}');
        const preview = escapeHTML(m.text.replace('{X}', label));
        d.innerHTML = `
          <h4>${preview}</h4>
          <div class="metaphor-mini">
            <span class="metaphor-tag">${m.form}</span>
            <span class="metaphor-tag">${m.category}</span>
            <span class="metaphor-tag">${m.tone}</span>
            <span class="metaphor-tag">Intensity ${m.intensity}</span>
            ${m.cliche?'<span class="metaphor-tag">Cliche</span>':''}
            <button class="metaphor-btn" data-id="${m.id}" data-act="use">Use</button>
            <button class="metaphor-btn metaphor-btn-ghost" data-id="${m.id}" data-act="fav">★</button>
          </div>
        `;
        els.list.appendChild(d);
      }
      els.count.textContent = `Showing ${items.length} of ${(state.viewFavorites?state.favorites:state.library).length}`;
      els.stats.textContent = `${state.library.length} ideas • ${state.favorites.length} favorites`;
      renderJSON();
    }

    function renderJSON(){
      els.json.textContent = JSON.stringify(state.library, null, 2);
    }

    // ---------- Pick & Insert ----------
    function weightedPick(pool){
      if (!pool.length) return null;
      const seeds = (els.seed.value||'').toLowerCase().split(',').map(s=>s.trim()).filter(Boolean);
      const weighted = pool.flatMap(m=>{
        let score = 1;
        const t = m.text.toLowerCase();
        for (const w of seeds) { if (w && t.includes(w)) score+=2; }
        return Array(Math.min(6,score)).fill(m);
      });
      return weighted[Math.floor(Math.random()*weighted.length)];
    }

    function generateMetaphor(){
      const pool = filteredLibrary();
      const chosen = weightedPick(pool) || {text:"No ideas match your filters. Clear filters or import more.", form:"", category:"", tone:"", intensity:0};
      state.picked = chosen;
      showPicked();
      return chosen;
    }

    function showPicked(){
      const m = state.picked; if (!m) { els.picked.innerHTML = ''; return; }
      const label = els.target.value || '{X}';
      const text = escapeHTML(m.text.replace('{X}', `<mark class="metaphor-mark">${escapeHTML(label)}</mark>`));
      els.picked.innerHTML = `
        <div><strong>Idea:</strong> ${text}</div>
        <div class="metaphor-mini">
          <span class="metaphor-tag">${m.form||''}</span>
          <span class="metaphor-tag">${m.category||''}</span>
          <span class="metaphor-tag">${m.tone||''}</span>
          <span class="metaphor-tag">Intensity ${m.intensity||''}</span>
          ${m.cliche ? '<span class="metaphor-tag">Cliche</span>' : ''}
        </div>
      `;
    }

    function insertIntoText(){
      const m = state.picked; if (!m) { toast('Generate an idea first'); return; }
      const label = els.target.value || '{X}';
      const insert = m.text.replace('{X}', label);
      const ta = els.ta;
      const start = ta.selectionStart, end = ta.selectionEnd;
      let from = label, to = insert;
      if (start !== end){
        from = ta.value.slice(start, end);
        to = m.text.replace('{X}', from);
        ta.setRangeText(to, start, end, 'end');
      } else {
        const pos = start; ta.setRangeText(to, pos, pos, 'end');
      }
      state.replacements.push({from, to, position:ta.selectionStart});
      toast('Inserted');
    }

    // ---------- Scan & Highlight ----------
    // rudimentary detection: mark metaphors in library that appear in text; flag cliches; detect mixed domains in window of 2 sentences
    function scanAndHighlight(){
      const text = els.ta.value;
      if (!text.trim()){ toast('Nothing to scan'); return; }
      const container = document.createElement('div');
      container.innerHTML = escapeHTML(text).replace(/\\n/g,'<br/>');

      const matches = [];
      for (const m of state.library){
        const pattern = m.text.replace('{X}','(.+?)');
        try{
          const re = new RegExp(pattern.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&').replace('\\\\(\\.\\+\\?\\\\)','(.+?)'), 'gi');
          let r; while ((r = re.exec(text))){ matches.push({start:r.index, end:r.index+r[0].length, meta:m}); }
        }catch{}
      }

      // sort and apply marks to plaintext indices
      matches.sort((a,b)=>a.start-b.start);
      let out = '', idx = 0, mixedDomains = [];
      for (const m of matches){
        out += escapeHTML(text.slice(idx, m.start));
        const cls = 'metaphor-mark' + (m.meta.cliche?' cliche':'');
        out += `<mark class="${cls}" title="${escapeHTML(m.meta.domain||'')}">${escapeHTML(text.slice(m.start, m.end))}</mark>`;
        idx = m.end;
        mixedDomains.push(m.meta.domain||'');
      }
      out += escapeHTML(text.slice(idx));

      // mixed metaphor heuristic: if 2+ distinct domains appear within ~2 sentences
      const distinct = new Set(mixedDomains.filter(Boolean));
      const status = [];
      if (distinct.size >= 2){ status.push('<span class="warn">Possible mixed metaphors</span>'); }
      if (matches.some(m=>m.meta.cliche)){ status.push('<span class="bad">Cliche spotted</span>'); }
      if (!status.length) status.push('<span class="ok">No obvious issues</span>');

      els.status.innerHTML = status.join(' • ');
      // show as HTML preview below textarea for quick review
      const preview = document.createElement('div');
      preview.style.marginTop = '8px';
      preview.innerHTML = out;
      // replace picked area with preview result
      $('#metaphor-picked').innerHTML = '<div><strong>Scan result:</strong></div>';
      $('#metaphor-picked').appendChild(preview);
      toast('Scan complete');
    }

    // ---------- Favorites & Export ----------
    function addFavorite(){
      const m = state.picked;
      if (!m || !m.id){ toast('Nothing to favorite'); return; }
      if (!state.favorites.some(x=>x.id===m.id)){ state.favorites.push(m); saveLocal(); toast('Added to favorites'); renderList(); }
    }
    function toggleFavView(){
      state.viewFavorites = !state.viewFavorites;
      toast(state.viewFavorites?'Viewing favorites':'Viewing library');
      renderList();
    }
    function clearFavorites(){
      state.favorites = []; saveLocal(); renderList(); toast('Favorites cleared');
    }

    function exportJSON(){
      const items = filteredLibrary();
      downloadFile('metaphors.json', JSON.stringify(items, null, 2), 'application/json');
    }
    function exportCSV(){
      const items = filteredLibrary();
      let csv = csvRow(['id','text','form','category','tone','intensity','domain','tags','cliche']);
      for (const m of items){
        csv += csvRow([m.id, m.text, m.form, m.category, m.tone, m.intensity, m.domain, (m.tags||[]).join('|'), m.cliche?1:0]);
      }
      downloadFile('metaphors.csv', csv, 'text/csv');
    }
    function exportMapCSV(){
      let csv = csvRow(['from','to','position']);
      for (const r of state.replacements){ csv += csvRow([r.from, r.to, r.position]); }
      downloadFile('metaphor-replacement-map.csv', csv, 'text/csv');
    }

    // ---------- Import ----------
    async function importJSON(file){
      try{
        const text = await file.text();
        const arr = JSON.parse(text);
        if (!Array.isArray(arr)) throw new Error('JSON must be an array');
        let maxId = Math.max(0, ...state.library.map(m=>m.id||0));
        const cleaned = arr.map(o=>{
          const id = ++maxId;
          return {
            id,
            text: String(o.text||o.metaphor||'').trim(),
            form: o.form||'metaphor',
            category: o.category||'',
            tone: o.tone||'',
            intensity: Number(o.intensity||3),
            domain: o.domain||'',
            tags: Array.isArray(o.tags)?o.tags: (o.tags? String(o.tags).split(',').map(s=>s.trim()): []),
            cliche: !!o.cliche
          }
        }).filter(m=>m.text);
        state.library.push(...cleaned);
        renderList(); renderJSON(); saveLocal();
        toast(`Imported ${cleaned.length} items`);
      } catch(e){ console.error(e); toast('Import failed'); }
    }

    // ---------- URL share ----------
    function encodeState(){
      const s = {
        t: els.target.value, f: els.form.value, c: els.category.value, o: els.tone.value,
        i: Number(els.intensity.value||0), nc: els.noCliche.checked?1:0, q: els.search.value, sd: els.seed.value,
        p: state.picked?.id || 0, fav: state.favorites.map(f=>f.id).slice(0,100)
      };
      const packed = btoa(unescape(encodeURIComponent(JSON.stringify(s))));
      history.replaceState(null,'','#'+packed);
      toast('Share link ready');
    }
    function decodeState(){
      const h = location.hash.slice(1); if (!h) return;
      try{
        const s = JSON.parse(decodeURIComponent(escape(atob(h))));
        els.target.value = s.t || '';
        els.form.value = s.f || '';
        els.category.value = s.c || '';
        els.tone.value = s.o || '';
        els.intensity.value = s.i || 0;
        els.noCliche.checked = s.nc !== 0;
        els.search.value = s.q || '';
        els.seed.value = s.sd || '';
        if (Array.isArray(s.fav) && s.fav.length){
          const map = new Map(state.library.map(m=>[m.id,m]));
          state.favorites = s.fav.map(id=>map.get(id)).filter(Boolean);
        }
        const pick = state.library.find(x=>x.id===s.p);
        if (pick){ state.picked = pick; showPicked(); }
      }catch(e){ console.warn('Bad hash'); }
    }

    // ---------- Local storage ----------
    function saveLocal(){
      try{
        localStorage.setItem('metaphor-library', JSON.stringify(state.library));
        localStorage.setItem('metaphor-favorites', JSON.stringify(state.favorites));
      }catch{}
    }
    function loadLocal(){
      try{
        const lib = JSON.parse(localStorage.getItem('metaphor-library')||'[]');
        const fav = JSON.parse(localStorage.getItem('metaphor-favorites')||'[]');
        if (Array.isArray(lib) && lib.length) state.library = lib;
        if (Array.isArray(fav) && fav.length) state.favorites = fav;
      }catch{}
    }

    // ---------- Events ----------
    function bindEvents(){
      els.gen.addEventListener('click', ()=>{
        const m = generateMetaphor();
        if (els.live.checked) insertIntoText();
      });
      els.insert.addEventListener('click', insertIntoText);
      els.copy.addEventListener('click', async ()=>{
        const t = state.picked ? state.picked.text.replace('{X}', els.target.value || '{X}') : '';
        if (!t) return toast('Nothing to copy');
        try{ await navigator.clipboard.writeText(t); toast('Copied'); }catch{ toast('Press Ctrl+C'); }
      });
      els.scan.addEventListener('click', scanAndHighlight);
      els.share.addEventListener('click', encodeState);

      // Import/Export
      els.importBtn.addEventListener('click', ()=> els.file.click());
      els.file.addEventListener('change', e => { const f=e.target.files?.[0]; if (f) importJSON(f); els.file.value=''; });
      els.exportJSON.addEventListener('click', exportJSON);
      els.exportCSV.addEventListener('click', exportCSV);
      els.exportMap.addEventListener('click', exportMapCSV);
      els.copyJSON.addEventListener('click', async ()=>{ try{await navigator.clipboard.writeText(els.json.textContent||''); toast('JSON copied'); }catch{ toast('Select and copy'); }});
      els.downloadJSON.addEventListener('click', ()=> downloadFile('metaphors.json', els.json.textContent||'[]', 'application/json'));

      // Filters
      ['change','input','keyup'].forEach(ev=>{
        [els.form, els.category, els.tone, els.intensity, els.noCliche, els.search, els.target, els.seed].forEach(el=>{
          el.addEventListener(ev, ()=>{
            renderList();
            if (els.live.checked && state.picked){ const m = generateMetaphor(); insertIntoText(); }
          });
        });
      });
      els.clearFilters.addEventListener('click', ()=>{
        els.form.value=''; els.category.value=''; els.tone.value=''; els.intensity.value=0; els.noCliche.checked=true; els.search.value='';
        renderList();
      });

      // Library list click
      els.list.addEventListener('click', e=>{
        const btn = e.target.closest('button[data-act]'); if (!btn) return;
        const id = Number(btn.dataset.id);
        const m = (state.viewFavorites?state.favorites:state.library).find(x=>x.id===id);
        if (!m) return;
        if (btn.dataset.act==='use'){ state.picked = m; showPicked(); if (els.live.checked) insertIntoText(); }
        if (btn.dataset.act==='fav'){ if (!state.favorites.some(x=>x.id===m.id)){ state.favorites.push(m); saveLocal(); toast('Added to favorites'); } renderList(); }
      });

      // Favorites view
      els.fav.addEventListener('click', addFavorite);
      els.viewFav.addEventListener('click', toggleFavView);
      els.clearFav.addEventListener('click', clearFavorites);

      // Keyboard shortcuts
      document.addEventListener('keydown', e=>{
        if (e.ctrlKey && e.key==='Enter'){ e.preventDefault(); els.gen.click(); }
        if (e.ctrlKey && (e.key==='b' || e.key==='B')){ e.preventDefault(); els.insert.click(); }
      });
    }

    // ---------- Init ----------
    loadLocal();
    renderList();
    renderJSON();
    decodeState();
    bindEvents();
  </script>
</body>
</html>
