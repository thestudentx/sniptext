<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GE98V48RK8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments)}
    gtag('js', new Date());
    gtag('config','G-GE98V48RK8');
  </script>

  <!-- Microsoft Clarity -->
  <script>
    (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y)
    })(window, document, "clarity", "script", "t5y2d08vd0");
  </script>
  <meta name="msvalidate.01" content="A9EB890789B5C28E62629F99EEDC30A1" />

  <!-- Essentials -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <base href="/tools/">

  <!-- Primary SEO -->
  <title>JSON Formatter & Validator - Prettier formatting, AJV schema check, JSONPath, flatten, share link | SnipText</title>
  <meta name="description" content="Format, minify, and validate JSON in your browser. Uses Prettier for clean formatting and AJV for JSON Schema checks with formats, defaults, and type coercion. Query with JSONPath, flatten or unflatten, auto-generate a draft schema, copy, download, and share a tiny link. Private and fast." />
  <meta name="keywords" content="json formatter, json validator, prettier json, ajv schema validation, json schema, jsonpath, flatten json, unflatten json, json pretty print, json minify, private in browser" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <!-- Canonical & hreflang -->
  <link rel="canonical" href="https://checkai.pro/tools/json-formatter-validator" />
  <link rel="alternate" href="https://checkai.pro/tools/json-formatter-validator" hreflang="en" />
  <link rel="alternate" href="https://checkai.pro/tools/json-formatter-validator" hreflang="x-default" />

  <!-- Styles -->
  <link rel="stylesheet" href="/css/style.css?v=reset1" />
  <link rel="stylesheet" href="/tools/css/free-tools.css?v=reset1" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="SnipText" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:title" content="JSON Formatter & Validator - Prettier + AJV" />
  <meta property="og:description" content="Format with Prettier and validate with AJV. JSONPath queries, flatten, schema generator, and shareable link. Private in your browser." />
  <meta property="og:url" content="https://checkai.pro/tools/json-formatter-validator" />
  <meta property="og:image" content="https://checkai.pro/images/sniptext-default-tools-img.png" />
  <meta property="og:image:secure_url" content="https://checkai.pro/images/sniptext-default-tools-img.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="JSON formatter and validator panels with schema badge" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="JSON Formatter & Validator - Prettier + AJV" />
  <meta name="twitter:description" content="Clean formatting and strong schema validation. JSONPath, flatten, share link. 100% in your browser." />
  <meta name="twitter:image" content="https://checkai.pro/images/sniptext-default-tools-img.png" />

  <!-- Theme / Icons -->
  <meta name="theme-color" content="#0F172A" />
  <link rel="icon" href="/favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png" />

  <!-- Fonts (brand stack) -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"/>

  <!-- Structured Data: WebApplication -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"SnipText JSON Formatter & Validator",
    "url":"https://checkai.pro/tools/json-formatter-validator",
    "applicationCategory":"DeveloperApplication",
    "operatingSystem":"All",
    "isAccessibleForFree":true,
    "featureList":[
      "Prettier formatting for JSON",
      "AJV JSON Schema validation with formats and defaults",
      "Type coercion and quick fix apply",
      "JSONPath queries",
      "Flatten and unflatten",
      "Draft schema generator from sample JSON",
      "Copy, download, and share tiny link"
    ],
    "publisher":{
      "@type":"Organization",
      "name":"SnipText",
      "logo":{"@type":"ImageObject","url":"https://checkai.pro/favicon.png","width":512,"height":512}
    }
  }
  </script>

  <!-- Structured Data: FAQPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"Is my JSON private",
       "acceptedAnswer":{"@type":"Answer","text":"Yes. The tool runs entirely in your browser. Nothing is uploaded."}},
      {"@type":"Question","name":"Can I validate against a schema",
       "acceptedAnswer":{"@type":"Answer","text":"Yes. Paste a JSON Schema and click Validate. You can enable formats, defaults and type coercion."}},
      {"@type":"Question","name":"Can I share a link",
       "acceptedAnswer":{"@type":"Answer","text":"Yes. Use Copy Link. For small inputs it compresses content into the URL hash."}}
    ]
  }
  </script>

  <style>
/* ==========================================================
   SNIPTEXT • JSON FORMATTER & VALIDATOR (Prettier + AJV)
   Dark theme with brand gradients • classes/ids include 'jso-for-val'
   Color variables include a word from the tool name
   ========================================================== */
:root{
  /* Brand theme mapped into tool-specific tokens */
  --json-primary: #1D4ED8;     /* color-primary */
  --formatter-accent: #3B82F6;  /* color-accent */
  --validator-bg-dark: #0F172A; /* color-bg-dark */
  --json-white: #ffffff;
  --json-text: #E6EEF8;
  --json-muted: #AAB6C7;
  --json-border: rgba(255,255,255,0.14);
  --formatter-warm: #ff7c4c;    /* gradient cta end */
  --validator-ember: #e85d27;   /* color-used-often */

  --json-green: #10B981;
  --json-red: #EF4444;
  --json-yellow: #F59E0B;
  --json-cyan: #22D3EE;
  --json-violet: #8B5CF6;

  --json-radius-xl: 20px;
  --json-radius-lg: 14px;
  --json-radius-md: 10px;

  --json-shadow-1: 0 10px 30px rgba(0,0,0,.35);
  --json-shadow-2: 0 18px 48px rgba(17,24,39,.46);

  color-scheme: dark;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--json-text);
  font-family:'Roboto','Poppins','Segoe UI',system-ui,-apple-system,Arial,sans-serif;
  background:
    radial-gradient(1200px 600px at 12% -10%, color-mix(in oklab, var(--json-primary) 26%, transparent), transparent 60%),
    radial-gradient(900px 500px at 100% 0%, color-mix(in oklab, var(--formatter-accent) 22%, transparent), transparent 52%),
    radial-gradient(800px 520px at 0% 100%, color-mix(in oklab, var(--formatter-warm) 14%, transparent), transparent 58%),
    linear-gradient(180deg, var(--validator-bg-dark) 0%, #1d1f2f 100%);
  background-attachment: fixed;
  min-height: 100vh;
}

/* Page shell */
.jso-for-val-main{
  width:min(1200px,92vw);
  margin: clamp(16px,3vw,40px) auto 80px;
}

/* Hero */
.jso-for-val-hero{
  display:grid; grid-template-columns: 1.15fr .85fr; gap: clamp(14px,2.4vw,22px); align-items:center;
  border:1px solid var(--json-border); border-radius:var(--json-radius-xl);
  padding: clamp(18px,3vw,28px);
  background: linear-gradient(135deg,
    color-mix(in oklab, var(--json-primary) 20%, transparent),
    color-mix(in oklab, var(--formatter-accent) 18%, transparent)
  ) border-box;
  backdrop-filter: blur(8px);
  box-shadow: var(--json-shadow-1);
  position:relative; overflow:hidden;
}
.jso-for-val-hero::after{
  content:""; position:absolute; inset:-3px; filter: blur(16px); opacity:.6; pointer-events:none;
  background:
    radial-gradient(600px 220px at 18% -6%, color-mix(in oklab, var(--json-primary) 28%, transparent), transparent 65%),
    radial-gradient(460px 280px at 86% 0%,  color-mix(in oklab, var(--formatter-accent) 26%, transparent), transparent 62%);
}
@media (max-width:980px){ .jso-for-val-hero{ grid-template-columns:1fr } }

.jso-for-val-title{
  margin:0 0 6px; font-weight:800; letter-spacing:.2px; line-height:1.12;
  font-family:'Poppins','Segoe UI',sans-serif;
  font-size: clamp(22px,3.2vw,36px);
  background: linear-gradient(90deg,#fff,
    color-mix(in oklab, var(--formatter-accent) 54%, #fff) 38%,
    color-mix(in oklab, var(--formatter-warm) 40%, #fff) 78%, #fff);
  -webkit-background-clip:text; background-clip:text; color:transparent;
}
.jso-for-val-sub{ margin:6px 0 0; color:var(--json-muted); font-size:clamp(14px,1.8vw,16px) }
.jso-for-val-badges{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px }
.jso-for-val-badge{
  padding:6px 10px; border:1px solid var(--json-border); border-radius:999px;
  background: color-mix(in oklab, #0F172A 72%, transparent); color:#dbe7ff; font-size:.82rem;
}

/* Animated hero icon: curly braces + check + bracket spinner */
.jsoforval-hero-art svg { justify-self: end; width:min(260px,42vw); height:auto; display:block; color:#d6e2ff }
.jfv-brace, .jfv-check, .jfv-gear { stroke: currentColor; fill: none; stroke-linecap: round; stroke-linejoin: round }
.jfv-brace { stroke-width: 2; filter: drop-shadow(0 0 2px rgba(255,255,255,.25)); animation: jfv-draw 1.6s ease forwards; stroke-dasharray: 240; stroke-dashoffset: 240 }
.jfv-check { stroke-width: 2.4; opacity:.0; animation: jfv-pop 1.2s ease .9s forwards }
.jfv-gear  { stroke-width: 2; opacity:.85; transform-origin: 160px 40px; animation: jfv-spin 6s linear infinite }

@keyframes jfv-draw { to { stroke-dashoffset: 0 } }
@keyframes jfv-pop {
  0% { opacity:0; transform: scale(.96) }
  60% { opacity:1; transform: scale(1.04) }
  100% { opacity:1; transform: scale(1) }
}
@keyframes jfv-spin { to { transform: rotate(360deg) } }

@media (prefers-reduced-motion: reduce){
  .jfv-brace { animation: none; stroke-dashoffset: 0 }
  .jfv-check, .jfv-gear { animation: none }
}

/* Grid */
.jso-for-val-grid{
  margin-top: clamp(14px,2.6vw,24px);
  display:grid; grid-template-columns: 1fr 1fr; gap: clamp(12px,2.4vw,20px);
}
@media (max-width:1100px){ .jso-for-val-grid{ grid-template-columns:1fr } }

/* Cards */
.jso-for-val-card{
  border:1px solid var(--json-border);
  border-radius:var(--json-radius-lg);
  background: rgba(255,255,255,.06);
  box-shadow: var(--json-shadow-2);
  backdrop-filter: blur(10px);
  overflow:hidden;
}
.jso-for-val-card-head{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:12px 14px;
  background: linear-gradient(90deg,
    color-mix(in oklab, var(--json-primary) 12%, transparent),
    color-mix(in oklab, var(--formatter-accent) 10%, transparent)
  );
  border-bottom:1px solid var(--json-border);
}
.jso-for-val-card-title{ margin:0; font-size:13px; letter-spacing:.35px; text-transform:uppercase; opacity:.9; font-family:'Poppins','Segoe UI',sans-serif }
.jso-for-val-section{ padding:12px 14px; display:grid; gap:12px }

/* Inputs */
.jso-for-val-field{ display:grid; gap:6px }
.jso-for-val-label{ font-weight:700; font-size:.95rem; color:#dfe7ff; letter-spacing:.2px }
.jso-for-val-textarea, .jso-for-val-input, .jso-for-val-select{
  background:#0e1730; color:#e6ecff; border:1px solid var(--json-border);
  border-radius:10px; padding:12px 14px; outline:none;
  transition:border-color .2s ease, box-shadow .2s ease, transform .12s ease;
  min-height:44px;
}
.jso-for-val-textarea{
  min-height:240px; resize:vertical; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
  line-height:1.45; font-size:13px; white-space:pre;
}
.jso-for-val-select{ appearance:none }
.jso-for-val-textarea:focus, .jso-for-val-input:focus, .jso-for-val-select:focus{
  border-color: rgba(59,130,246,.55); box-shadow:0 0 0 3px rgba(59,130,246,.25); transform:translateY(-1px)
}
.jso-for-val-row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center }

/* Buttons */
.jso-for-val-btn{
  --_bg: linear-gradient(180deg, color-mix(in oklab, var(--json-primary) 70%, transparent), color-mix(in oklab, var(--formatter-accent) 62%, transparent));
  --_txt:#fff; --_bd: color-mix(in oklab, #000 12%, var(--json-primary));
  appearance:none; border:1px solid var(--_bd); background:var(--_bg); color:var(--_txt);
  padding:10px 12px; border-radius:12px; font-weight:700; font-size:13px; letter-spacing:.3px; cursor:pointer;
  transition: transform .15s ease, filter .15s ease, box-shadow .2s ease, background .3s ease;
  box-shadow: 0 10px 20px rgba(29,78,216,.22), 0 6px 14px rgba(59,130,246,.16);
  font-family:'Poppins','Segoe UI',sans-serif;
}
.jso-for-val-btn:hover{ transform: translateY(-1px); filter: brightness(1.06) }
.jso-for-val-btn:active{ transform: translateY(0); filter: brightness(.98) }
.jso-for-val-btn-ghost{ background:transparent; color:#e5e7eb; border:1px dashed var(--json-border); box-shadow:none }
.jso-for-val-btn-warm{ background: linear-gradient(135deg, var(--formatter-accent), var(--formatter-warm)); border-color:transparent }
.jso-for-val-btn-red{ background: linear-gradient(135deg, #EF4444, #F59E0B); border-color: transparent }
.jso-for-val-btn-green{ background: linear-gradient(135deg, #10B981, #3B82F6); border-color: transparent }

/* Output */
.jso-for-val-pane{
  border:1px solid var(--json-border); border-radius:10px; overflow:auto; background: rgba(14,23,48,.6);
  max-height:520px; position:relative;
}
.jso-for-val-lines{ counter-reset: ln; padding:10px }
.jso-for-val-code{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; font-size:13px; line-height:1.5; white-space:pre-wrap; word-break:break-word }

/* Status pills */
.jso-for-val-pill{
  display:inline-flex; align-items:center; gap:8px;
  padding:6px 10px; border:1px solid var(--json-border); border-radius:999px;
  background: color-mix(in oklab, #0F172A 72%, transparent); color:#bcd3ff; font-size:.8rem;
}

/* Toast */
.jso-for-val-toast{
  position: fixed; inset: auto 16px 16px auto;
  background: #0b1223ee; color:#e5e7eb; padding: 10px 14px; border-radius: 12px; border:1px solid var(--json-border);
  backdrop-filter: blur(8px); box-shadow: var(--json-shadow-1);
  transform: translateY(20px); opacity:0; pointer-events:none;
  transition: transform .25s ease, opacity .25s ease;
  z-index: 50;
}
.jso-for-val-toast.show{ transform: translateY(0); opacity:1 }

/* Accessible focus */
:focus-visible{ outline:2px solid color-mix(in oklab, var(--formatter-accent) 60%, #fff); outline-offset:2px }

/* Subtle float */
@media (prefers-reduced-motion:no-preference){
  .jso-for-val-card{ animation: jfv-float 18s ease-in-out infinite }
  @keyframes jfv-float{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(-2px)} }
}

/* Utility */
.kbd{
  font: 600 11px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
  background: color-mix(in oklab, #0F172A 78%, transparent); color:#cbd5e1;
  padding:3px 6px; border-radius:8px; border:1px solid var(--json-border);
}

.feature-card-all-pages {margin: 0 2rem;}
.tools-grid {margin: 1rem; background: #0e1730;}
.tool-card {background: #0f1b34;}
@media (max-width: 600px) { .tools-grid {margin: 1rem 0;} }
  </style>
</head>
<body>



    
  
<nav id="main-navbar">
  <div class="nav-container">
    <div class="logo">
      <a href="/index.html">Snip Text</a>
    </div>
    <div class="hamburger" id="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <ul class="nav-links" id="nav-links">
      <li><a href="/index.html">Home</a></li>
      <li><a href="/tools/free-tools.html">Free Tools</a></li>
      <li><a href="/features.html">Features</a></li>
      <li><a href="/about.html">About</a></li>
      <li><a href="/blog/blog.html">Blog</a></li>
      <li><a href="/contact.html">Contact</a></li>
      <li><a id="nav-dashboard-link" href="/login.html">Dashboard</a></li>
      <li><a id="nav-logout-link" href="#" style="display:none;">Logout</a></li>
    </ul>
  </div>
</nav>







<main class="jso-for-val-main" id="jso-for-val-main" aria-label="JSON Formatter and Validator">
  <!-- HERO -->
  <section class="jso-for-val-hero" aria-labelledby="jso-for-val-title">
    <div>
      <h1 class="jso-for-val-title" id="jso-for-val-title">JSON Formatter & Validator - Prettier + AJV</h1>
      <p class="jso-for-val-sub">
        Format JSON with Prettier, validate with AJV, explore with JSONPath, and share a tiny link. Flatten or unflatten objects, auto-generate a draft schema from your sample, and apply schema defaults or type coercion. Everything runs in your browser.
      </p>
      <div class="jso-for-val-badges">
        <span class="jso-for-val-badge">Local only</span>
        <span class="jso-for-val-badge">Prettier formatting</span>
        <span class="jso-for-val-badge">AJV schema check</span>
        <span class="jso-for-val-badge">JSONPath</span>
      </div>
    </div>

    <!-- Animated hero icon: curly braces, checkmark, tiny gear -->
    <div class="jsoforval-hero-art" aria-hidden="true">
      <svg viewBox="0 0 200 160" role="img" aria-label="Animated JSON braces and validator check">
        <!-- curly braces -->
        <path class="jfv-brace" d="M64 20c-10 0-16 6-16 16v12c0 6-4 10-10 10 6 0 10 4 10 10v12c0 10 6 16 16 16m72-76c10 0 16 6 16 16v12c0 6 4 10 10 10-6 0-10 4-10 10v12c0 10-6 16-16 16" />
        <!-- check -->
        <path class="jfv-check" d="M76 118l12 12 26-28" />
        <!-- spinning brace-gear hybrid -->
        <g class="jfv-gear">
          <circle cx="160" cy="40" r="14" fill="none"/>
          <path d="M160 24v6 M160 50v6 M174 40h-6 M152 40h-6 M169 31l-4 4 M151 49l-4 4 M169 49l-4-4 M151 31l-4-4" />
        </g>
      </svg>
    </div>
  </section>

  <!-- GRID -->
  <section class="jso-for-val-grid">
    <!-- LEFT: JSON input and actions -->
    <article class="jso-for-val-card">
      <header class="jso-for-val-card-head">
        <h2 class="jso-for-val-card-title">JSON input</h2>
        <div class="jso-for-val-row">
          <button class="jso-for-val-btn jso-for-val-btn-ghost" id="jfv-clear-json">Clear</button>
          <button class="jso-for-val-btn" id="jfv-sample-json">Load sample</button>
        </div>
      </header>

      <div class="jso-for-val-section">
        <div class="jso-for-val-field">
          <label class="jso-for-val-label" for="jfv-json">Your JSON</label>
          <textarea id="jfv-json" class="jso-for-val-textarea" placeholder="Paste or drop JSON here" aria-label="JSON input" spellcheck="false"></textarea>
          <div class="jso-for-val-row">
            <input type="file" id="jfv-json-file" class="jso-for-val-input" accept=".json,.txt,.log" aria-label="Upload JSON file"/>
            <button class="jso-for-val-btn jso-for-val-btn-ghost" id="jfv-paste-json" title="Paste from clipboard"><span class="kbd">Ctrl</span>+<span class="kbd">V</span> paste</button>
          </div>
        </div>

        <div class="jso-for-val-row">
          <label class="jso-for-val-label" for="jfv-indent">Indent</label>
          <select id="jfv-indent" class="jso-for-val-select" aria-label="Indent size">
            <option value="2">2 spaces</option>
            <option value="4">4 spaces</option>
            <option value="8">8 spaces</option>
          </select>

          <label class="jso-for-val-label"><input type="checkbox" id="jfv-jsonc" /> Allow comments and trailing commas (JSONC)</label>
          <label class="jso-for-val-label"><input type="checkbox" id="jfv-sort" /> Sort keys</label>
          <label class="jso-for-val-label"><input type="checkbox" id="jfv-live" /> Live format</label>
        </div>

        <div class="jso-for-val-row">
          <button class="jso-for-val-btn" id="jfv-format" title="Format with Prettier">Format</button>
          <button class="jso-for-val-btn jso-for-val-btn-ghost" id="jfv-minify" title="Minify JSON">Minify</button>
          <button class="jso-for-val-btn jso-for-val-btn-warm" id="jfv-copy" title="Copy JSON">Copy</button>
          <button class="jso-for-val-btn jso-for-val-btn-ghost" id="jfv-download" title="Download JSON">Download</button>
          <button class="jso-for-val-btn jso-for-val-btn-warm" id="jfv-share" title="Copy shareable link">Copy link</button>
        </div>

        <div class="jso-for-val-row">
          <label class="jso-for-val-label" for="jfv-jsonpath">JSONPath</label>
          <input id="jfv-jsonpath" class="jso-for-val-input" placeholder="Example: $.users[*].id" aria-label="JSONPath query" />
          <button class="jso-for-val-btn" id="jfv-run-jsonpath">Run</button>
          <button class="jso-for-val-btn jso-for-val-btn-ghost" id="jfv-clear-jsonpath">Clear</button>
        </div>

        <div class="jso-for-val-row">
          <button class="jso-for-val-btn" id="jfv-flatten" title="Flatten nested objects">Flatten</button>
          <button class="jso-for-val-btn jso-for-val-btn-ghost" id="jfv-unflatten" title="Unflatten to nested objects">Unflatten</button>
          <button class="jso-for-val-btn" id="jfv-gen-schema" title="Generate a draft JSON Schema from the sample">Generate schema</button>
        </div>
      </div>
    </article>

    <!-- RIGHT: Schema + validation -->
    <aside class="jso-for-val-card" aria-live="polite">
      <header class="jso-for-val-card-head">
        <h2 class="jso-for-val-card-title">Schema & validation</h2>
        <div class="jso-for-val-row">
          <span class="jso-for-val-pill" id="jfv-stat-bytes">Size: -</span>
          <span class="jso-for-val-pill" id="jfv-stat-keys">Keys: -</span>
          <span class="jso-for-val-pill" id="jfv-stat-depth">Depth: -</span>
        </div>
      </header>

      <div class="jso-for-val-section">
        <div class="jso-for-val-field">
          <label class="jso-for-val-label" for="jfv-schema">JSON Schema (Draft 2020-12 or 7)</label>
          <textarea id="jfv-schema" class="jso-for-val-textarea" placeholder="Paste JSON Schema here" aria-label="JSON Schema" spellcheck="false"></textarea>
          <div class="jso-for-val-row">
            <input type="file" id="jfv-schema-file" class="jso-for-val-input" accept=".json,.txt" aria-label="Upload Schema file"/>
            <button class="jso-for-val-btn jso-for-val-btn-ghost" id="jfv-sample-schema">Load sample</button>
          </div>
        </div>

        <div class="jso-for-val-row">
          <label class="jso-for-val-label"><input type="checkbox" id="jfv-ajv-formats" checked /> Enable format checks</label>
          <label class="jso-for-val-label"><input type="checkbox" id="jfv-ajv-defaults" /> Apply defaults</label>
          <label class="jso-for-val-label"><input type="checkbox" id="jfv-ajv-coerce" /> Coerce types</label>
          <label class="jso-for-val-label"><input type="checkbox" id="jfv-ajv-all" checked /> Show all errors</label>
        </div>

        <div class="jso-for-val-row">
          <button class="jso-for-val-btn jso-for-val-btn-green" id="jfv-validate" title="Validate with AJV">Validate</button>
          <button class="jso-for-val-btn jso-for-val-btn-ghost" id="jfv-apply-fixes" title="Apply defaults and coercions into JSON">Apply schema fixes</button>
          <button class="jso-for-val-btn jso-for-val-btn-red" id="jfv-clear-errors" title="Clear results">Clear results</button>
        </div>

        <div class="jso-for-val-pane" id="jfv-results-pane" aria-label="Validation results">
          <div class="jso-for-val-lines jso-for-val-code" id="jfv-results">No results yet.</div>
        </div>
      </div>
    </aside>
  </section>

  <!-- OUTPUT PREVIEW -->
  <section class="jso-for-val-card" style="margin-top:14px">
    <header class="jso-for-val-card-head">
      <h2 class="jso-for-val-card-title">Preview</h2>
      <div class="jso-for-val-row">
        <span class="jso-for-val-pill" id="jfv-preview-state">Formatted preview will appear here</span>
      </div>
    </header>
    <div class="jso-for-val-section">
      <div class="jso-for-val-pane" id="jfv-preview-pane" aria-label="Formatted preview">
        <pre class="jso-for-val-lines jso-for-val-code" id="jfv-preview" aria-live="polite"></pre>
      </div>
    </div>
  </section>

  <div style="margin-top:16px">
    <p class="jso-for-val-sub">More you might like:
      <a href="/tools/quick-table-generator-csv-to-html-table-code.html">Quick Table Generator</a>,
      <a href="/tools/word-counter.html">Word Counter</a>,
      <a href="/tools/symbol-character-info.html">Symbol Character Info</a>,
      <a href="/tools/random-synonym-finder-smart-thesaurus-batch-rewrite-tone-length-filters-free-online-tool-sniptext.html">Random Synonym Finder</a>.
    </p>
  </div>


     <div class="free-tools-guide">
    <p class="free-tools-guide-p">See JSON Formatting Guide on SnipText Blog Page <a href="/blog/json-formatter-and-validator-prettier-ajv-jsonpath-flatten-guide-sniptext-blog.html" class="free-tools-blog-link">here</a>.</p>
  </div>
</main>

<!-- Toast -->
<div id="jfv-toast" class="jso-for-val-toast" role="status" aria-live="polite"></div>


    <!-- TOOLS GRID -->
       <div class="feature-card-all-pages">
        <h1 class="feature-card-all-pages-para">Featured Tools</h1>
       </div>
  <section id="tools-grid" class="tools-grid" aria-label="Tools list">
    <!-- Tool cards - 10 items -->

    <article class="tool-card table-gen-tool-card" tabindex="0" data-href="/tools/quick-table-generator-csv-to-html-table-code.html" aria-labelledby="table-gen-tg">
        <div class="card-icon table-gen-card-icon" aria-hidden="true">
          <!-- Grid/Table icon -->
          <svg viewBox="0 0 24 24" class="svg-icon table-gen-svg" xmlns="http://www.w3.org/2000/svg" role="img">
            <rect x="3" y="4" width="18" height="16" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.4"/>
            <path d="M3 9h18M3 14h18M8 4v16M14 4v16" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
          </svg>
        </div>
        <h3 id="table-gen-tg" class="card-title table-gen-card-title">Quick Table Generator</h3>
        <p class="card-desc table-gen-card-desc">
          Paste or upload CSV to generate clean, responsive HTML table code with auto-detect delimiter, header toggle, sort, filter, paginate, transpose, sticky header, and one-click copy or download. Private, in-browser.
        </p>
        <a class="card-cta table-gen-card-cta" href="/tools/quick-table-generator-csv-to-html-table-code.html" aria-label="Open Quick Table Generator">Open →</a>
      </article>

      <article class="tool-card" tabindex="0" data-href="/tools/timeline-maker-academic-timeline.html" aria-labelledby="t13">
          <div class="card-icon" aria-hidden="true">
            <!-- Timeline icon: calendar + vertical line with nodes -->
            <svg viewBox="0 0 24 24" class="svg-icon">
              <!-- Calendar frame -->
              <rect x="3" y="4.5" width="18" height="16" rx="2.5" ry="2.5" stroke="currentColor" stroke-width="1.4" fill="none"/>
              <path d="M3 8h18" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" />
              <path d="M8 4.5v-2M16 4.5v-2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
              <!-- Vertical timeline -->
              <path d="M8.5 11v7" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
              <circle cx="8.5" cy="12.5" r="1.4" fill="currentColor"/>
              <circle cx="8.5" cy="15.5" r="1.4" fill="currentColor"/>
              <circle cx="8.5" cy="18" r="1.4" fill="currentColor"/>
              <!-- Event cards hint -->
              <path d="M11.5 12.5h6M11.5 15.5h5M11.5 18h4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
            </svg>
          </div>
          <h3 id="t13" class="card-title">Timeline Maker</h3>
          <p class="card-desc">Enter events to auto-generate an academic-style timeline with categories, eras, zoom, drag-reorder, and one-click export to HTML, SVG, or JSON. Private, in-browser.</p>
          <a class="card-cta" href="/tools/timeline-maker-academic-timeline.html" aria-label="Open Timeline Maker">Open →</a>
        </article>

    <article class="tool-card" tabindex="0" data-href="/tools/duplicate-word-finder.html" aria-labelledby="t3">
      <div class="card-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" class="svg-icon">
          <path d="M3 7h8v10H3zM13 3h8v10h-8z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </svg>
      </div>
      <h3 id="t3" class="card-title">Duplicate Word Finder</h3>
      <p class="card-desc">Find repeated words and common duplicates, with options to highlight or remove them automatically.</p>
      <a class="card-cta" href="/tools/duplicate-word-finder.html" aria-label="Open Duplicate Word Finder">Open →</a>
    </article>

    <article class="tool-card" tabindex="0" data-href="/tools/whitespace-and-formatting-cleaner.html" aria-labelledby="t4">
      <div class="card-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" class="svg-icon">
          <path d="M3 7h18M8 11h8M6 15h12M4 19h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </svg>
      </div>
      <h3 id="t4" class="card-title">Whitespace & Formatting Cleaner</h3>
      <p class="card-desc">Trim whitespace, normalize newlines, remove extra spaces, and fix inconsistent indentation.</p>
      <a class="card-cta" href="/tools/whitespace-and-formatting-cleaner.html" aria-label="Open Whitespace & Formatting Cleaner">Open →</a>
    </article>

  </section>






  
<footer id="main-footer" class="site-footer" aria-labelledby="footer-heading">
  <!-- decorative background -->
  <div class="footer-bg" aria-hidden="true"></div>

  <div class="footer-container">
    <div class="footer-logo">
      <h2 id="footer-heading" class="footer-brand">Snip Text</h2>
      <p>Empowering better writing, one tool at a time.</p>
    </div>

    <nav class="footer-links" aria-label="Footer links">
      <a href="feedback.html">Feedback</a>
      <a href="contact.html#contact">Contact Us</a>
      <a href="privacy-policy.html">Privacy Policy</a>
      <a href="terms-of-use.html">Terms of Use</a>
    </nav>

    <div class="footer-bottom">
      <p>
        &copy; <span id="year"></span>
        <span class="powered-by">
          Snip Text - powered by
          <a href="https://checkai.pro" target="_blank" rel="noopener">CheckAI.pro</a>
        </span>
        · All rights reserved.
      </p>
    </div>
  </div>

  <!-- back to top -->
  <button class="to-top" id="to-top" aria-label="Back to top">
    <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
      <path d="M12 5l-6 6m6-6l6 6M12 5v14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
</footer>





<script src="js/index.js?v=reset1" defer></script>
<script src="js/auth.js?v=reset1" defer></script>
<script src="/tools/js/free-tools.js?v=reset1"></script>


<!-- Libraries (defer, ordered) -->
<script defer src="https://unpkg.com/prettier@2.8.8/standalone.js"></script>
<script defer src="https://unpkg.com/prettier@2.8.8/parser-babel.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/ajv@8/dist/ajv.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/ajv-formats@2/dist/ajv-formats.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/jsonpath-plus@7.2.0/dist/index-browser-umd.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>

<script>
(function(){
  'use strict';

  // Elements
  const $ = (sel) => document.querySelector(sel);
  const jsonEl = $('#jfv-json');
  const schemaEl = $('#jfv-schema');
  const previewEl = $('#jfv-preview');
  const previewStateEl = $('#jfv-preview-state');
  const resultsEl = $('#jfv-results');
  const toastEl = $('#jfv-toast');

  // Controls
  const indentEl = $('#jfv-indent');
  const allowJSONC = $('#jfv-jsonc');
  const sortKeysEl = $('#jfv-sort');
  const liveEl = $('#jfv-live');

  // AJV toggles
  const ajvFormatsEl = $('#jfv-ajv-formats');
  const ajvDefaultsEl = $('#jfv-ajv-defaults');
  const ajvCoerceEl = $('#jfv-ajv-coerce');
  const ajvAllErrorsEl = $('#jfv-ajv-all');

  // Stats
  const statBytes = $('#jfv-stat-bytes');
  const statKeys  = $('#jfv-stat-keys');
  const statDepth = $('#jfv-stat-depth');

  // Helpers
  const showToast = (msg) => {
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    setTimeout(()=>toastEl.classList.remove('show'), 1600);
  };

  const readFileToText = (file) => new Promise((resolve,reject)=>{
    const reader = new FileReader();
    reader.onload = () => resolve(String(reader.result || ''));
    reader.onerror = reject;
    reader.readAsText(file);
  });

  // JSONC pre-clean: remove // and /* */ comments, and trailing commas
  const stripJSONC = (text) => {
    // remove block comments
    let s = text.replace(/\/\*[\s\S]*?\*\//g, '');
    // remove line comments
    s = s.replace(/(^|[^:\\])\/\/.*$/gm, '$1');
    // remove trailing commas in objects and arrays
    s = s.replace(/,\s*([}\]])/g, '$1');
    return s;
  };

  // Sort keys recursively
  const sortKeysDeep = (obj) => {
    if (Array.isArray(obj)) return obj.map(sortKeysDeep);
    if (obj && typeof obj === 'object') {
      const out = {};
      Object.keys(obj).sort((a,b)=>a.localeCompare(b)).forEach(k=>{
        out[k] = sortKeysDeep(obj[k]);
      });
      return out;
    }
    return obj;
  };

  // Stats for JSON
  const computeStats = (val) => {
    let bytes = 0, keys = 0, depth = 0;
    const text = typeof val === 'string' ? val : JSON.stringify(val);
    bytes = new Blob([text]).size;

    const walk = (v, d) => {
      if (d > depth) depth = d;
      if (Array.isArray(v)) v.forEach(item => walk(item, d+1));
      else if (v && typeof v === 'object') {
        keys += Object.keys(v).length;
        Object.values(v).forEach(item => walk(item, d+1));
      }
    };
    try {
      const obj = typeof val === 'string' ? JSON.parse(val) : val;
      walk(obj, 0);
    } catch {
      // ignore
    }
    return {bytes, keys, depth};
  };

  // Format using Prettier
  const prettyFormat = (raw, indent) => {
    const cleaned = allowJSONC.checked ? stripJSONC(raw) : raw;
    const options = {
      parser: 'json',
      plugins: window.prettierPlugins ? [window.prettierPlugins.babel] : [],
      tabWidth: Number(indent) || 2,
      printWidth: 80
    };
    return window.prettier.format(cleaned, options);
  };

  // Minify JSON
  const minify = (raw) => {
    const cleaned = allowJSONC.checked ? stripJSONC(raw) : raw;
    const obj = JSON.parse(cleaned);
    return JSON.stringify(obj);
  };

  // Parse JSON safely with options
  const parseJSON = (raw, doSort=false) => {
    const cleaned = allowJSONC.checked ? stripJSONC(raw) : raw;
    const obj = JSON.parse(cleaned);
    return doSort ? sortKeysDeep(obj) : obj;
  };

  // Render preview and stats
  const renderPreview = () => {
    try {
      let txt = jsonEl.value;
      if (!txt.trim()) {
        previewEl.textContent = '';
        previewStateEl.textContent = 'Waiting for input';
        statBytes.textContent = 'Size: -';
        statKeys.textContent = 'Keys: -';
        statDepth.textContent = 'Depth: -';
        return;
      }
      const formatted = prettyFormat(txt, indentEl.value);
      previewEl.textContent = formatted;
      previewStateEl.textContent = 'Formatted preview';
      const {bytes, keys, depth} = computeStats(formatted);
      statBytes.textContent = `Size: ${bytes.toLocaleString()} bytes`;
      statKeys.textContent  = `Keys: ${keys}`;
      statDepth.textContent = `Depth: ${depth}`;
    } catch (e) {
      previewEl.textContent = String(e.message || e);
      previewStateEl.textContent = 'Parsing error';
    }
  };

  // Copy helper
  const copyToClipboard = async (text) => {
    await navigator.clipboard.writeText(text);
    showToast('Copied to clipboard');
  };

  // Download helper
  const downloadText = (text, name='data.json') => {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([text], {type:'application/json'}));
    a.download = name;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(a.href);
  };

  // Share link using LZString in URL hash
  const makeShareLink = () => {
    const data = jsonEl.value || '';
    const schema = schemaEl.value || '';
    const opts = JSON.stringify({
      indent: indentEl.value,
      jsonc: !!allowJSONC.checked,
      sort: !!sortKeysEl.checked
    });
    const payload = JSON.stringify({d:data, s:schema, o:opts});
    const enc = LZString.compressToEncodedURIComponent(payload);
    const url = `${location.origin}${location.pathname}#jfv=${enc}`;
    return url;
  };

  const loadFromHash = () => {
    const hash = location.hash;
    const m = hash.match(/#jfv=([^&]+)/);
    if (!m) return;
    try {
      const payload = JSON.parse(LZString.decompressFromEncodedURIComponent(m[1]));
      if (payload && typeof payload === 'object') {
        jsonEl.value = payload.d || '';
        schemaEl.value = payload.s || '';
        if (payload.o) {
          const o = JSON.parse(payload.o);
          indentEl.value = o.indent || '2';
          allowJSONC.checked = !!o.jsonc;
          sortKeysEl.checked = !!o.sort;
        }
      }
    } catch { /* ignore */ }
    renderPreview();
  };

  // JSONPath run
  const runJSONPath = () => {
    try {
      const obj = parseJSON(jsonEl.value, false);
      const expr = $('#jfv-jsonpath').value || '$';
      const out = JSONPath.JSONPath({path: expr, json: obj});
      resultsEl.textContent = JSON.stringify(out, null, 2);
      showToast('JSONPath executed');
    } catch (e) {
      resultsEl.textContent = 'JSONPath error: ' + e.message;
    }
  };

  // Flatten and unflatten
  const flatten = (obj, prefix='') => {
    const out = {};
    const step = (val, pre) => {
      if (Array.isArray(val)) {
        val.forEach((v,i)=>step(v, `${pre}[${i}]`));
      } else if (val && typeof val === 'object') {
        Object.keys(val).forEach(k=>step(val[k], pre ? `${pre}.${k}` : k));
      } else {
        out[pre] = val;
      }
    };
    step(obj, prefix);
    return out;
  };

  const unflatten = (flat) => {
    const result = {};
    for (const [path, value] of Object.entries(flat)) {
      const parts = path.replace(/\[(\d+)\]/g, '.$1').split('.');
      let cur = result;
      parts.forEach((p, idx) => {
        const last = idx === parts.length - 1;
        const isIndex = /^\d+$/.test(p);
        if (last) {
          if (isIndex) {
            if (!Array.isArray(cur)) cur = [];
            cur[p] = value;
          } else {
            cur[p] = value;
          }
        } else {
          const nextIsIndex = /^\d+$/.test(parts[idx+1]);
          if (isIndex) {
            if (!Array.isArray(cur[p])) cur[p] = [];
          } else {
            if (!cur[p] || typeof cur[p] !== 'object') cur[p] = nextIsIndex ? [] : {};
          }
          cur = cur[p];
        }
      });
    }
    return result;
  };

  // Draft schema generator (very basic)
  const typeOf = (v) => Array.isArray(v) ? 'array' : (v === null ? 'null' : typeof v);
  const genSchema = (sample) => {
    const t = typeOf(sample);
    if (t === 'object') {
      const props = {};
      const req = [];
      for (const [k,v] of Object.entries(sample)) {
        props[k] = genSchema(v);
        req.push(k);
      }
      return { type:'object', properties: props, required: req, additionalProperties: true };
    }
    if (t === 'array') {
      const first = sample[0];
      return { type:'array', items: first === undefined ? {} : genSchema(first) };
    }
    if (t === 'number') return { type:'number' };
    if (t === 'string') return { type:'string' };
    if (t === 'boolean') return { type:'boolean' };
    if (t === 'null') return { type:'null' };
    return {};
  };

  // AJV validation
  const validateWithAjv = (applyFixes=false) => {
    let obj, schema;
    try { obj = parseJSON(jsonEl.value, sortKeysEl.checked); }
    catch (e) { resultsEl.textContent = 'JSON error: ' + e.message; return; }

    try { schema = parseJSON(schemaEl.value, false); }
    catch (e) { resultsEl.textContent = 'Schema error: ' + e.message; return; }

    const ajv = new Ajv({
      allErrors: !!ajvAllErrorsEl.checked,
      strict: false,
      coerceTypes: !!ajvCoerceEl.checked,
      useDefaults: !!ajvDefaultsEl.checked
    });
    if (ajvFormatsEl.checked && window.ajvFormats) ajvFormats(ajv);

    let validate;
    try { validate = ajv.compile(schema); }
    catch (e) { resultsEl.textContent = 'Schema compile error: ' + e.message; return; }

    let data = JSON.parse(JSON.stringify(obj)); // clone to apply defaults/coercions without mutating yet
    const valid = validate(data);

    if (applyFixes) {
      // write back applied defaults and coercions into the editor
      try {
        const formatted = prettyFormat(JSON.stringify(sortKeysEl.checked ? sortKeysDeep(data) : data), indentEl.value);
        jsonEl.value = formatted;
        renderPreview();
        showToast('Schema fixes applied to JSON');
      } catch (e) {
        showToast('Could not apply fixes: ' + e.message);
      }
    }

    if (valid) {
      resultsEl.textContent = 'Valid ✔ The JSON conforms to the provided schema.';
      resultsEl.style.color = 'var(--json-green)';
    } else {
      resultsEl.style.color = '';
      const out = validate.errors.map((e,i)=>{
        const path = e.instancePath || e.dataPath || '';
        const msg = e.message || 'error';
        const exp = e.params && e.params.allowedValues ? ` allowed: ${JSON.stringify(e.params.allowedValues)}` : '';
        return `${i+1}. at "${path || '/'}" - ${msg}${exp}`;
      }).join('\n');
      resultsEl.textContent = 'Invalid ✖ Schema errors:\n' + out;
    }
  };

  // Event bindings
  $('#jfv-format').addEventListener('click', () => {
    try {
      let obj = parseJSON(jsonEl.value, sortKeysEl.checked);
      let text = JSON.stringify(obj);
      const formatted = prettyFormat(text, indentEl.value);
      jsonEl.value = formatted;
      renderPreview();
      showToast('Formatted');
    } catch (e) {
      resultsEl.textContent = 'Format error: ' + e.message;
    }
  });

  $('#jfv-minify').addEventListener('click', () => {
    try {
      const m = minify(jsonEl.value);
      jsonEl.value = m;
      renderPreview();
      showToast('Minified');
    } catch (e) {
      resultsEl.textContent = 'Minify error: ' + e.message;
    }
  });

  $('#jfv-copy').addEventListener('click', () => copyToClipboard(jsonEl.value || ''));
  $('#jfv-download').addEventListener('click', () => downloadText(jsonEl.value || '', 'data.json'));

  $('#jfv-clear-json').addEventListener('click', () => { jsonEl.value = ''; renderPreview(); });
  $('#jfv-paste-json').addEventListener('click', async () => {
    try { jsonEl.value = await navigator.clipboard.readText(); renderPreview(); }
    catch { showToast('Clipboard read blocked'); }
  });

  $('#jfv-json-file').addEventListener('change', async (e) => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    jsonEl.value = await readFileToText(file);
    renderPreview();
    e.target.value = '';
  });

  // Drag and drop on JSON area
  jsonEl.addEventListener('dragover', (e)=>{ e.preventDefault(); jsonEl.style.borderColor = 'rgba(59,130,246,.6)' });
  jsonEl.addEventListener('dragleave', ()=>{ jsonEl.style.borderColor = 'var(--json-border)' });
  jsonEl.addEventListener('drop', async (e)=>{
    e.preventDefault(); jsonEl.style.borderColor = 'var(--json-border)';
    const file = e.dataTransfer.files && e.dataTransfer.files[0];
    if (file) { jsonEl.value = await readFileToText(file); renderPreview(); }
  });

  // Sample JSON & Schema
  $('#jfv-sample-json').addEventListener('click', ()=>{
    jsonEl.value = JSON.stringify({
      id: 123,
      name: "Alice",
      email: "alice@example.com",
      active: true,
      roles: ["admin","user"],
      profile: { createdAt: "2025-01-01T12:00:00Z", score: 4.5 }
    }, null, 2);
    renderPreview();
  });

  $('#jfv-sample-schema').addEventListener('click', ()=>{
    schemaEl.value = JSON.stringify({
      $schema: "https://json-schema.org/draft/2020-12/schema",
      type: "object",
      properties: {
        id: { type: "integer" },
        name: { type: "string" },
        email: { type: "string", format: "email" },
        active: { type: "boolean", default: false },
        roles: { type: "array", items: { type: "string" } },
        profile: {
          type: "object",
          properties: {
            createdAt: { type: "string", format: "date-time" },
            score: { type: "number" }
          },
          required: ["createdAt"]
        }
      },
      required: ["id","name","email"]
    }, null, 2);
  });

  // JSONPath
  $('#jfv-run-jsonpath').addEventListener('click', runJSONPath);
  $('#jfv-clear-jsonpath').addEventListener('click', ()=>{ $('#jfv-jsonpath').value=''; resultsEl.textContent = 'JSONPath cleared.'; });

  // Flatten / Unflatten
  $('#jfv-flatten').addEventListener('click', ()=>{
    try {
      const obj = parseJSON(jsonEl.value, false);
      const flat = flatten(obj);
      jsonEl.value = prettyFormat(JSON.stringify(flat), indentEl.value);
      renderPreview();
      showToast('Flattened');
    } catch (e) {
      resultsEl.textContent = 'Flatten error: ' + e.message;
    }
  });

  $('#jfv-unflatten').addEventListener('click', ()=>{
    try {
      const flat = parseJSON(jsonEl.value, false);
      const obj = unflatten(flat);
      jsonEl.value = prettyFormat(JSON.stringify(obj), indentEl.value);
      renderPreview();
      showToast('Unflattened');
    } catch (e) {
      resultsEl.textContent = 'Unflatten error: ' + e.message;
    }
  });

  // Generate schema
  $('#jfv-gen-schema').addEventListener('click', ()=>{
    try {
      const obj = parseJSON(jsonEl.value, false);
      const schema = genSchema(obj);
      schemaEl.value = prettyFormat(JSON.stringify(schema), indentEl.value);
      showToast('Draft schema generated');
    } catch (e) {
      resultsEl.textContent = 'Schema generation error: ' + e.message;
    }
  });

  // Validation
  $('#jfv-validate').addEventListener('click', ()=>validateWithAjv(false));
  $('#jfv-apply-fixes').addEventListener('click', ()=>validateWithAjv(true));
  $('#jfv-clear-errors').addEventListener('click', ()=>{ resultsEl.textContent = 'No results yet.'; resultsEl.style.color=''; });

  // Share link
  $('#jfv-share').addEventListener('click', async ()=>{
    try {
      const url = makeShareLink();
      await copyToClipboard(url);
      showToast('Share link copied');
    } catch {
      showToast('Could not create link');
    }
  });

  // Schema file
  $('#jfv-schema-file').addEventListener('change', async (e) => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    schemaEl.value = await readFileToText(file);
    e.target.value = '';
  });

  // Live formatting
  let liveTimer = null;
  jsonEl.addEventListener('input', ()=>{
    if (!liveEl.checked) return;
    clearTimeout(liveTimer);
    liveTimer = setTimeout(()=>{ try {
      // try formatting silently
      const obj = parseJSON(jsonEl.value, sortKeysEl.checked);
      const formatted = prettyFormat(JSON.stringify(obj), indentEl.value);
      jsonEl.value = formatted;
      renderPreview();
    } catch { /* ignore while typing */ } }, 300);
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', (e)=>{
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
      e.preventDefault(); downloadText(jsonEl.value || '', 'data.json');
    }
    if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key.toLowerCase() === 'c') {
      e.preventDefault(); copyToClipboard(jsonEl.value || '');
    }
  });

  // Init
  loadFromHash();
  renderPreview();
})();
</script>
</body>
</html>
